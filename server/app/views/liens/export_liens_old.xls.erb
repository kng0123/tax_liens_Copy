<?xml version="1.0"?>
<Workbook xmlns="urn:schemas-microsoft-com:office:spreadsheet"
  xmlns:o="urn:schemas-microsoft-com:office:office"
  xmlns:x="urn:schemas-microsoft-com:office:excel"
  xmlns:ss="urn:schemas-microsoft-com:office:spreadsheet"
  xmlns:html="http://www.w3.org/TR/REC-html40">
  <Styles>
     <Style ss:ID="1">

     </Style>
     <ss:Style ss:ID="money">
        <ss:NumberFormat ss:Format="Currency"/>
    </ss:Style>
    <ss:Style ss:ID="header">
       <ss:Font ss:Bold="1"/>
       <ss:Alignment ss:Horizontal="Center"/>
   </ss:Style>
  </Styles>
  <Worksheet ss:Name="Sheet1">
    <Table>
      <%
      max_number_receipt = 0
      max_number_subs = 0
      @liens.each do |lien|
        num_receipts = lien.receipts.count
        if num_receipts > max_number_receipt
          max_number_receipt = num_receipts
        end

        num_subs = lien.subsequents.count
        if num_subs > max_number_subs
          max_number_subs = num_subs
        end
      end

      %>

      <Row>
        <Cell><Data ss:Type="String">Unique ID</Data></Cell>
        <Cell><Data ss:Type="String">County</Data></Cell>
        <Cell><Data ss:Type="String">Year</Data></Cell>
        <Cell><Data ss:Type="String">LLC</Data></Cell>
        <Cell><Data ss:Type="String">Block/Lot</Data></Cell>
        <Cell><Data ss:Type="String">Block</Data></Cell>
        <Cell><Data ss:Type="String">Lot</Data></Cell>
        <Cell><Data ss:Type="String">Qualifier</Data></Cell>
        <Cell><Data ss:Type="String">Adv #</Data></Cell>
        <Cell><Data ss:Type="String">MUA Acct # / Parcel ID</Data></Cell>
        <Cell><Data ss:Type="String">Cert #</Data></Cell>
        <Cell><Data ss:Type="String">Lien Type</Data></Cell>
        <Cell><Data ss:Type="String">List Item</Data></Cell>
        <Cell><Data ss:Type="String">Current Owner</Data></Cell>
        <Cell><Data ss:Type="String">Longitude</Data></Cell>
        <Cell><Data ss:Type="String">Latitude</Data></Cell>
        <Cell><Data ss:Type="String">Assessed Value</Data></Cell>
        <Cell><Data ss:Type="String">Tax Amount</Data></Cell>
        <Cell><Data ss:Type="String">Status</Data></Cell>
        <Cell><Data ss:Type="String">Address</Data></Cell>
        <Cell><Data ss:Type="String">Cert FV</Data></Cell>
        <Cell><Data ss:Type="String">Winning Bid</Data></Cell>
        <Cell><Data ss:Type="String">Premium</Data></Cell>
        <Cell><Data ss:Type="String">Total Paid</Data></Cell>
        <Cell><Data ss:Type="String">Sale Date</Data></Cell>

        <% (1..max_number_subs).each do |i| %>
        <Cell><Data ss:Type="String">Tax</Data></Cell>
        <Cell><Data ss:Type="String">Tax Date</Data></Cell>
        <Cell><Data ss:Type="String">xx</Data></Cell>
        <Cell><Data ss:Type="String">8%</Data></Cell>
        <Cell><Data ss:Type="String">xx</Data></Cell>
        <Cell><Data ss:Type="String">18%</Data></Cell>
        <Cell><Data ss:Type="String">Check</Data></Cell>
        <Cell><Data ss:Type="String">Utility 1</Data></Cell>
        <Cell><Data ss:Type="String">Utility Date 1</Data></Cell>
        <Cell><Data ss:Type="String">xx</Data></Cell>
        <Cell><Data ss:Type="String">8%</Data></Cell>
        <Cell><Data ss:Type="String">xx</Data></Cell>
        <Cell><Data ss:Type="String">18%</Data></Cell>
        <Cell><Data ss:Type="String">Check</Data></Cell>
        <Cell><Data ss:Type="String">Total 1</Data></Cell>
        <% end %>

        <Cell><Data ss:Type="String">Total Subs Paid</Data></Cell>
        <Cell><Data ss:Type="String">Redemption Date</Data></Cell>
        <Cell><Data ss:Type="String">Redemption Amount</Data></Cell>
        <Cell><Data ss:Type="String">Total Cash Out</Data></Cell>
        <Cell><Data ss:Type="String">Total Int Due</Data></Cell>
        <Cell><Data ss:Type="String">MZ Check</Data></Cell>
        <Cell><Data ss:Type="String">Dif</Data></Cell>
        <Cell><Data ss:Type="String">Notes</Data></Cell>
        <Cell><Data ss:Type="String">Mailed Cert</Data></Cell>

        <% (1..max_number_receipt).each do |i| %>
        <Cell><Data ss:Type="String">Deposit Date</Data></Cell>
        <Cell><Data ss:Type="String">Check Date</Data></Cell>
        <Cell><Data ss:Type="String">Redemption Date</Data></Cell>
        <Cell><Data ss:Type="String">Account</Data></Cell>
        <Cell><Data ss:Type="String">Check #</Data></Cell>
        <Cell><Data ss:Type="String">Check Amount</Data></Cell>
        <Cell><Data ss:Type="String">Code</Data></Cell>
        <Cell><Data ss:Type="String">Expected Amount</Data></Cell>
        <Cell><Data ss:Type="String">Dif</Data></Cell>
        <Cell><Data ss:Type="String">Check Principal</Data></Cell>
        <Cell><Data ss:Type="String">Check Actual Interest</Data></Cell>
        <Cell><Data ss:Type="String">Notes</Data></Cell>
        <% end %>

        <Cell><Data ss:Type="String">xx</Data></Cell>
        <Cell><Data ss:Type="String">Principal Bal</Data></Cell>
        <Cell><Data ss:Type="String">Total Interest Earned</Data></Cell>
        <Cell><Data ss:Type="String">xx</Data></Cell>
        <!--  Not part of current work -->
        <!-- <Cell><Data ss:Type="String">Face Redeemed</Data></Cell>
        <Cell><Data ss:Type="String">Prem Redeemed</Data></Cell>
        <Cell><Data ss:Type="String">Subs Redeemed</Data></Cell>
        <Cell><Data ss:Type="String">Principal Redemption Month</Data></Cell>
        <Cell><Data ss:Type="String">xx</Data></Cell> -->
      </Row>

      <% @liens.each do |lien| %>
      <Row>
        <Cell><Data ss:Type="String"><%= lien.id %></Data></Cell>
        <Cell><Data ss:Type="String"><%= lien.township.name %></Data></Cell>
        <Cell><Data ss:Type="String"><%= lien.year %></Data></Cell>
        <Cell><Data ss:Type="String"><%= lien.llcs.first.name %></Data></Cell>
        <Cell><Data ss:Type="String"><%= lien.block_lot %></Data></Cell>
        <Cell><Data ss:Type="String"><%= lien.block %></Data></Cell>
        <Cell><Data ss:Type="String"><%= lien.lot %></Data></Cell>
        <Cell><Data ss:Type="String"><%= lien.qualifier %></Data></Cell>
        <Cell><Data ss:Type="String"><%= lien.adv_number %></Data></Cell>
        <Cell><Data ss:Type="String"><%= lien.mua_accounts.first.account_number %></Data></Cell>
        <Cell><Data ss:Type="String"><%= lien.cert_number %></Data></Cell>
        <Cell><Data ss:Type="String"><%= lien.lien_type %></Data></Cell>
        <Cell><Data ss:Type="String"><%= lien.list_item %></Data></Cell>
        <Cell><Data ss:Type="String"><%= lien.llcs.first.name %></Data></Cell>
        <Cell><Data ss:Type="String"><%= lien.longitude %></Data></Cell>
        <Cell><Data ss:Type="String"><%= lien.latitude %></Data></Cell>
        <Cell ss:StyleID="money"><Data ss:Type="Number" ><%= (lien.assessed_value or 0) / 100 %></Data></Cell>
        <Cell ss:StyleID="money"><Data ss:Type="Number" ><%= (lien.tax_amount or 0) / 100  %></Data></Cell>
        <Cell><Data ss:Type="String"><%= lien.status %></Data></Cell>
        <Cell><Data ss:Type="String"><%= lien.address %></Data></Cell>
        <Cell ss:StyleID="money"><Data ss:Type="Number" ><%= (lien.cert_fv or 0) / 100  %></Data></Cell>
        <Cell ss:StyleID="money"><Data ss:Type="Number" ><%= (lien.winning_bid) %></Data></Cell>
        <Cell ss:StyleID="money"><Data ss:Type="Number" ><%= (lien.premium or 0) / 100  %></Data></Cell>
        <Cell ss:StyleID="money"><Data ss:Type="Number" ><%= (lien.total_paid or 0) / 100  %></Data></Cell>
        <Cell><Data ss:Type="String" ><%= lien.sale_date %></Data></Cell>

        <% (0..max_number_subs-1).each do |i|
          sub = lien.subsequents[i]
          if sub.nil?
            (1..15).each do |e|
            %>
              <Cell><Data ss:Type="String"></Data></Cell>
            <% end %>
          <% else %>
            <Cell><Data ss:Type="String">Tax</Data></Cell>
            <Cell><Data ss:Type="String">Tax Date</Data></Cell>
            <Cell><Data ss:Type="String">xx</Data></Cell>
            <Cell><Data ss:Type="String">8%</Data></Cell>
            <Cell><Data ss:Type="String">xx</Data></Cell>
            <Cell><Data ss:Type="String">18%</Data></Cell>
            <Cell><Data ss:Type="String">Check</Data></Cell>
            <Cell><Data ss:Type="String">Utility 1</Data></Cell>
            <Cell><Data ss:Type="String">Utility Date 1</Data></Cell>
            <Cell><Data ss:Type="String">xx</Data></Cell>
            <Cell><Data ss:Type="String">8%</Data></Cell>
            <Cell><Data ss:Type="String">xx</Data></Cell>
            <Cell><Data ss:Type="String">18%</Data></Cell>
            <Cell><Data ss:Type="String">Check</Data></Cell>
            <Cell><Data ss:Type="String">Total 1</Data></Cell>
          <% end %>
        <% end %>

        <Cell><Data ss:Type="String">Total Subs Paid</Data></Cell>
        <Cell><Data ss:Type="String">Redemption Date</Data></Cell>
        <Cell><Data ss:Type="String">Redemption Amount</Data></Cell>
        <Cell><Data ss:Type="String">Total Cash Out</Data></Cell>
        <Cell><Data ss:Type="String">Total Int Due</Data></Cell>
        <Cell><Data ss:Type="String">MZ Check</Data></Cell>
        <Cell><Data ss:Type="String">Dif</Data></Cell>
        <Cell><Data ss:Type="String">Notes</Data></Cell>
        <Cell><Data ss:Type="String">Mailed Cert</Data></Cell>

        <% (0..max_number_receipt-1).each do |i|
          receipt = lien.receipts[i]
          if receipt.nil?
            (1..12).each do |e|
            %>
              <Cell><Data ss:Type="String"></Data></Cell>
            <% end %>
          <% else %>
            <Cell><Data ss:Type="String"><%= receipt.deposit_date %></Data></Cell>
            <Cell><Data ss:Type="String"><%= receipt.check_date %></Data></Cell>
            <Cell><Data ss:Type="String"><%= receipt.redeem_date %></Data></Cell>
            <Cell><Data ss:Type="String"><%= "What account is this" %></Data></Cell>
            <Cell><Data ss:Type="String"><%= receipt.check_number %></Data></Cell>
            <Cell ss:StyleID="money"><Data ss:Type="Number" ><%= (receipt.check_amount or 0) / 100  %></Data></Cell>
            <Cell><Data ss:Type="String"><%= receipt.receipt_type %></Data></Cell>
            <Cell ss:StyleID="money"><Data ss:Type="Number" ><%= "expected_amount" %></Data></Cell>
            <Cell ss:StyleID="money"><Data ss:Type="Number" ><%= "diff" %></Data></Cell>
            <Cell ss:StyleID="money"><Data ss:Type="Number" ><%= "principal" %></Data></Cell>
            <Cell ss:StyleID="money"><Data ss:Type="Number" ><%= "actual_interest" %></Data></Cell>
            <Cell><Data ss:Type="String"><%= "NOTESTODO" %></Data></Cell>
          <% end %>
        <% end %>

        <Cell><Data ss:Type="String">xx</Data></Cell>
        <Cell><Data ss:Type="String">Principal Bal</Data></Cell>
        <Cell><Data ss:Type="String">Total Interest Earned</Data></Cell>
        <Cell><Data ss:Type="String">xx</Data></Cell>

      </Row>
      <%
      end
      %>
    </Table>
  </Worksheet>
</Workbook>
